<imart type="head">
  <imart type="jsspRpc" name="jsspRpcAccountRegisterSample" page="lo/contents/screen/account/account_register_sample"></imart>
  <html lang="ja">
  <meta charset="UTF-8">
  <title>アカウント登録サンプル</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">
  <style>
    /* 画面全体の最大幅と余白 */
    #account-register { max-width: 760px; margin: 1.5rem auto; }

    /* ラベルや間隔の標準化 */
    #account-register label { font-weight: 600; }

    /* カードの見た目 */
    #account-register .card { border-radius: .75rem; }
    #account-register .card-header { background: #fff; border-bottom: 1px solid rgba(0,0,0,.075); }
    #account-register .card-header .h4 { margin: 0; }

    /* IM UI と衝突しやすい箇所の保護（チェックボックス・ラベル） */
    #account-register .custom-control { position: relative; }
    #account-register .custom-control-label {
      line-height: 1.5;
      display: inline-block;
      padding-top: .1rem;
    }
    #account-register .custom-control-label::before,
    #account-register .custom-control-label::after {
      top: .15rem; /* ラベルと縦位置を揃える */
    }

    /* 入力の上下間隔 */
    #account-register .form-group { margin-bottom: 1rem; }
  </style>
</imart>
<body id="body">
  <main id="account-register" class="container">
    <div class="card shadow-sm">
      <div class="card-header">
        <h1 class="h4">アカウント登録サンプル</h1>
      </div>
      <div class="card-body">
        <form id="registerForm" novalidate>
          <div class="form-group">
            <label for="userCd">ユーザコード</label>
            <input type="text" id="userCd" class="form-control" placeholder="例）taro@example.com" required>
          </div>

          <div class="form-group">
            <label for="password">パスワード</label>
            <div class="input-group">
              <input type="password" id="password" class="form-control" placeholder="（任意）">
              <div class="input-group-append">
                <button class="btn btn-outline-secondary" type="button" id="togglePw">表示</button>
              </div>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group col-md-6">
              <label for="validStart">有効開始</label>
              <input type="datetime-local" id="validStart" class="form-control" required>
            </div>
            <div class="form-group col-md-6">
              <label for="validEnd">有効終了</label>
              <input type="datetime-local" id="validEnd" class="form-control" required>
            </div>
          </div>

          <div class="custom-control custom-checkbox mb-3">
            <input type="checkbox" class="custom-control-input" id="doLicense">
            <label class="custom-control-label" for="doLicense">ライセンス登録を行う</label>
          </div>

          <div class="d-flex">
            <button id="registerBtn" type="button" class="btn btn-success">登録</button>
          </div>
        </form>
      </div>
    </div>
  </main>

  <!-- 既存の registerResult と RPC 呼び出しロジック（そのまま） -->
  <script type="text/javascript">
    function registerResult(res) {
      var msg = (res && res.ok) ? "登録しました" : ("失敗しました: " + (res && res.message ? res.message : ""));
      var type = (res && res.ok) ? "message" : "warning";
      try {
        $("<div>" + msg + "</div>").imuiMessageDialog({
          iconType: 'im-ui-icon-common-24-confirmation',
          title: (type === 'warning') ? '警告' : 'メッセージ',
          modal: true
        });
      } catch (e) {
        alert(msg);
      }
    }

    // パスワード表示切替（任意）
    (function($){
      $('#togglePw').on('click', function(){
        var $pw = $('#password');
        var show = $pw.attr('type') === 'password';
        $pw.attr('type', show ? 'text' : 'password');
        $(this).text(show ? '非表示' : '表示');
      });

      $('#registerBtn').on('click', function(){
        var p = {
          userCd:     $('#userCd').val(),
          password:   $('#password').val(),
          validStart: $('#validStart').val(),
          validEnd:   $('#validEnd').val(),
          doLicense:  $('#doLicense').is(':checked')
        };
        var res = jsspRpcAccountRegisterSample.registerAccount(p);
        registerResult(res);
      });
    })(jQuery);
  </script>
</body>
</html>
