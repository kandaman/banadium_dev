<!DOCTYPE html>
<html lang="ja">
<imart type="head">
	<meta charset="UTF-8">
	<meta http-equiv="Pragma" content="no-cache">
	<meta http-equiv="Cache-Control" content="no-cache">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<!--link rel="stylesheet" href="lo_csjs/cform.css" -->
	
	<!-- IMART -->
	<imart type="jsspRpc" name="jsspRpcKawariDetail" page="lo/contents/screen/kawari/kawari_detail"></imart>

	<link rel="stylesheet" type="text/css" href="lo_csjs/reset.css">
	<link rel="stylesheet" type="text/css" href="lo_csjs/bootstrap.css">
	<link rel="stylesheet" type="text/css" href="lo_csjs/all.min.css">
	<link rel="stylesheet" href="lo_csjs/selectize.default.css">
	<!-- link rel="stylesheet" href="lo_csjs/cform.css" -->
	<link rel="stylesheet" type="text/css" href="lo_csjs/selectize.default.css">
	<link rel="stylesheet" type="text/css" href="lo_csjs/progress-tracker.css">
	<link rel="stylesheet" type="text/css" href="lo_csjs/checkbox.css">
	<link rel="stylesheet" type="text/css" href="lo_csjs/basetype.css">
	<link rel="stylesheet" type="text/css" href="lo_csjs/udcolor_sample.css">
	<link href="lo_csjs/jquery.fileuploader.min.css" media="all" rel="stylesheet">
	<link rel="stylesheet" type="text/css" href="lo_csjs/fileupload.css" />
	<link rel="stylesheet" type="text/css" href="lo_csjs/lo_common.css">
	
	<script src="https://kit.fontawesome.com/b5f0d7b6c6.js" crossorigin="anonymous"></script>

<imart type="condition" validity=$shanaiShuseiFlg negative>
	<imart type="workflowOpenPageCsjs" />
	<script type="text/javascript" src="workflow/csjs/greybox_lo.js"></script>
</imart>

<style type="text/css">
<!--
#kikaku_shohin_table td {
  	word-break: break-word;
	white-space: normal;
}

#kyodaku_shohin_table td {
  	word-break: break-word;
	white-space: normal;
}

#kanren_bunsho_table td {
  	word-break: break-word;
	white-space: normal;
}

table.dataTable td.dataTables_empty {
	border: 1px solid #c8c8cb;
}
.margin-all {
	margin: 28px !important;
}
.margin-left {
	margin-left: 16px !important;
}

textarea.biko {
	width: 100%;
}

.left-justified {
	padding-left: 0px !important;
}
.right-justified {
	padding-right: 0px !important;
}

#kyodaku_shohin_table, #kikaku_shohin_table{
	table-layout: fixed;
}

#kanren_bunsho_table thead th:nth-child(1){
	width: 100px;
	min-width: 100px;
}
#kanren_bunsho_table thead th:nth-child(2){
	width: 100px;
	min-width: 100px;
}
#kanren_bunsho_table thead th:nth-child(3){
	min-width: 400px;
}
#kanren_bunsho_table thead th:nth-child(4){
	min-width: 400px;
}

textarea{
	margin-right: 0;
}
-->
.line-height {
		line-height: 100px;
	}
.padding-top {
		padding-top: 0.7rem !important;
	}
	.full_width {
		 width: 100% !important;
	}

.node-list{
	display: flex;
	align-items: stretch;
}

.node-list .node-name{
	border:1px solid #cccccc;
	width:10%;
	background-color: #ffca80 !important;
	text-align:center;
}
	
.node-item{	
	width:10%;
	height:100%;
}

.tsuchi-item .node-name{
	border:1px solid #cccccc;
	width:100%;
	padding:5px;
	background-color: #ffca80 !important;
	text-align:center;	
}

.node-name{
	min-height:30px;
}

.node-tanto{
	border:1px solid #cccccc;
	width:10%;
	padding:5px;	
	text-align:left;
}

.tsuchi-item{	
	width:10%;
	margin-right:20px;
}

.tsuchi-item ul{	
	border:1px solid #cccccc;
	width:100%;
	padding:5px;	
	text-align:left;
	min-height:30px;
}

.tsuchi-item ul li {
    margin: 0 0 5px 0;
    padding: 2px 6px;
}

.back-color {
	border: 1px solid #c8c8cb !important;
}

div {
  	word-break: break-word;
	white-space: normal;
}

</style>

	<script src="https://kit.fontawesome.com/b5f0d7b6c6.js" crossorigin="anonymous"></script>
	<script type="text/javascript" src="lo_csjs/bootstrap.min.js"></script>
	<imart type="include" page="lo/contents/screen/footer"></imart>
	<script type="text/javascript" src="lo_csjs/moment.min.js"></script>

    <script type="text/javascript" src="lo_csjs/jquery.fileuploader.min.js"></script>
	<script type="text/javascript" src="lo_csjs/jquery.dataTables.min.js"></script>
	<script type="text/javascript" src="lo_csjs/lo_common.js"></script>
	<script type="text/javascript" src="lo_csjs/popup.js" type="text/javascript"></script>
	<script type="text/javascript" src="lo_csjs/form-change-trigger.js"></script>
	<script type="text/javascript" src="lo_csjs/decimal.js"></script>

	<script type="text/javascript">
	
		var $fileList = []; // 編集時のファイル格納用
		var $tempUpFileCount = 0;
		var $tempUpFileSuccessCount = 0;
		var $tempUpFileErrotCount = 0;
		// ---- 詳細資料ファイル -------
		// ファイルアップロード前処理用
		function onBeforeSendFiles(e, data) {
			// ファイル数制限
			var uploadedNum = $("#after_file_select .afterFileSelect").size();
			var max_file_num = <imart type="string" value=$maxFileNum />;
			if(uploadedNum + $tempUpFileCount + data.files.length >= max_file_num) {
				return false;
			}
			
			var str = '<imart type="string" value=$extListstr />';
			var max_file_size = <imart type="string" value=$maxFileSize />;
			var acceptExt =str.split("/");
			for (var fIdx = 0; fIdx < data.files.length; fIdx++) {
				// ファイルサイズチェック
				if(data.files[fIdx].size > max_file_size) {
					alert('<imart type="message" id="ER01E005" escapeJs="true"></imart>');
					return false;
				}
				
				// 拡張子チェック
				var ext = getFileExtension(data.files[fIdx].name);
				if (!acceptExt.includes(ext)) {
					var altstr = '<imart type="message" id="KY02E031" escapeJs="true"></imart>';
					altstr = altstr.replace("{0}", data.files[fIdx].name);
					alert(altstr);
					return false;
				}
			}
			// TODO:アップロードするファイルのサイズや拡張子をチェック
			// TODO:複数ファイルのアップロードをしたときに、途中のファイルがfalseを返却した場合は、後続は続行されるか確認
			// TODO:インジケータ表示のために、アップロードされたファイルをカウントする仮実装
			showIndicator();
			$tempUpFileCount += data.files.length;
			
			return true;
		}
		// ファイルアップロード成功時
		function onSuccessFiles(e, data) {
			// TODO:インジケータ表示のために、アップロードされたファイルをカウントする仮実装
			$tempUpFileSuccessCount += data.result.length;

			$.each(data.result, function(index, res) {
				var src ="lo/contents/screen/ses_file_dl?filePath=" + res.physicalName + "&fileName=" + res.name;
				var a_src = $('<a>').attr({'href':src, 'download':''});
				var clon = $("#after_file_select_template > .afterFileSelect").clone(true);
				clon.find(".upfilenametext").text(res.name);
				clon.find('input[name="item_upFile_name"]').val(res.name);
				clon.find('input[name="item_upFile_resname"]').val(res.physicalName);
				clon.find(".upfilenametext").wrap(a_src);
				clon.show();
				clon.appendTo("#after_file_select");
			});

			// TODO:インジケータ表示のために、アップロードされたファイルをカウントする仮実装
			if ($tempUpFileCount == $tempUpFileSuccessCount + $tempUpFileErrotCount) {
				$tempUpFileCount = 0;
				$tempUpFileSuccessCount = 0;
				$tempUpFileErrotCount = 0;
				hideIndicator();
			}
		}

		// アップロード失敗
		function onErrorFiles(e, data) {
			// TODO:失敗時の処理をいれる
			// TODO:インジケータ表示のために、アップロードされたファイルをカウントする仮実装
			$tempUpFileErrotCount += data.files.length;
			if ($tempUpFileCount == $tempUpFileSuccessCount + $tempUpFileErrotCount) {
				$tempUpFileCount = 0;
				$tempUpFileSuccessCount = 0;
				$tempUpFileErrotCount = 0;
				hideIndicator();
			}
		}
		// ---- 詳細資料ファイル -------

		// ---- ファイルアップロード共通 -------
		// アップロード削除
		function upFileDel(targetEl){
			// TODO:確認メッセージを表示
			var targetObj = $(targetEl).closest("div");
			targetObj.remove();
		}
		// ---- ファイルアップロード共通 -------
</script>

	<title>代わり承認WF</title>
</imart>

<imart type="workflowOpenPage"
       name="workflowOpenPageForm"
       id="workflowOpenPageForm"
       method="POST"
       target="_top"
       imwUserDataId=$wf_data.imwUserDataId
       imwSystemMatterId=$wf_data.imwSystemMatterId
       imwAuthUserCode=$wf_data.imwAuthUserCode
       imwApplyBaseDate=$wf_data.imwApplyBaseDate
       imwNodeId=$wf_data.imwNodeId
       imwFlowId=$wf_data.imwFlowId
       imwCallOriginalParams=$wf_data.imwCallOriginalParams
       imwNextScriptPath=$wf_data.imwCallOriginalPagePath
       >
	<!-- ノード設定用パラメータ-->
	<imart type="hidden" imwNodeSetting=$wf_data.imwNodeSetting escapeJs="false" escapeXml="true"/>
    <!-- ワークフロー用カスタムロパラメータ -->
	<input type="hidden" name="imwCustomParam" id="imwCustomParam" >
    <!-- 処理ステータス -->
	<input type="hidden" name="item_proc_status" id="item_proc_status" value="">
    <!-- 処理ステータスコード（DB設定用） -->
	<input type="hidden" name="item_status_cd" id="item_status_cd" value="">
    <!-- 処理ステータス名（ボタン名）-->
	<input type="hidden" name="item_proc_name" id="item_proc_name" value="">
    <!-- 案件名（文書idを設定） -->
	<IMART type="hidden" item_matterName=$kawari_data.bunsho_id />
    <!-- 差戻先 -->
	<IMART type="hidden" imwBackNodeSetting=$wf_data.imwBackNodeSetting />
	<!-- 許諾判定 -->
	<IMART type="hidden" isKyodaku=$viewCtrl.isKyodaku />
	<!-- 再利用判定 -->
	<IMART type="hidden" sairiyoFlg=$sairiyoFlg />
</imart>

<body id="body" style="display: none">

	<!-- header -->
	<div class="container-fluid">
		<imart type="include" page="lo/contents/screen/header"></imart>
	</div>
	<!-- header -->
	<form id="sendFrom" method="get"
		action="lo/contents/screen/kawari/kawari_register">
		<IMART type="hidden" bunsho_id=$kawari_data.bunsho_id></IMART>
	</form>
	<div class="container">
		<div class="row">
			<!-- sidebar -->
			<div id="lo_sidebar">
				<div class="sidebar_fixed">
					<imart type="include" page="lo/contents/screen/sidemenu"></imart>
				</div>
			</div>
			<!-- sidebar -->
			<!-- main contents -->
			<div class="main col">

				<!-- sidebar show -->
				<a id="show-sidebar" class="btn" style="display:none">
					<i class="fas fa-share-square"></i>
				</a>
				<!-- sidebar show -->

				<!-- contents custom -->
				<div class="page-information row my-4">
					<div class="col-12 col-lg-3">
						<imart type="decision" value=$bunshoCls case="4">
						<h1><imart type="message" id="LO.TITLE.KAWARI.PLANNING_ITEM" escapeXml="true" /></h1>
						</imart>
						<imart type="decision" value=$bunshoCls case="5">
						<h1><imart type="message" id="LO.TITLE.KAWARI.KYODAKU" escapeXml="true" /></h1>
						</imart>
						<imart type="decision" value=$bunshoCls case="6">
						<h1><imart type="message" id="LO.TITLE.KAWARI.LICENSE_PROPORSAL" escapeXml="true" /></h1>
						</imart>						
					</div>
					<div class="col-12 col-lg-7 mt-3">
						<!-- <imart type="message" id="KY02I015" escapeJs="true"></imart>-->
					</div>				
					<div class="col-12 col-lg-6">						
						<button type="button" onclick="history.back();return false;" class="brdr_orange txt_orange mt-2" id="history_back_button">
							<i class="fas fa-caret-left "></i><span>戻る</span>
						</button>
						<imart type="condition" validity=$viewCtrl.isSairiyou>
						<button type="button" id="btn_sairiyou" class="bg_orange txt_dark"><i class="fas fa-recycle fa-2x"></i><span>再利用</span></button>
						</imart>
						<button type="button" id="btn_print" class="bg_orange txt_dark"><i class="fas fa-print fa-2x"></i><span>印刷画面表示</span></button>					
					</div>									
				</div>
				
				<div>
					<article>
						<section class="show">
							<div class="container">
								<imart type="condition" validity=$before_apply>
									<div class="row" id="msg_before_teisyutu" style="display:none;">
										<div class="col-1"></div>
										<div class="col-10 pt-3 pb-3 lo-center border border-info text-info">
											<b><imart type="message" id="IN01I014" escapeJs="true" args=$action_name></imart></b>
										</div>
										<div class="col-1"></div>
									</div>
								</imart>
							</div>
						</section>
					</article>
				</div>

				<article class="print-area">
					<section class="show">
						<div class="container">
							<div class="row">
								<div class="col-12">																
									<div class="col-12 row mt-2 mb-2">
										
										<div class="col-4 col-lg-2 t-header bg_ltorange brdr_ltgray text-center">文書番号</div>
										<div class="col-5 col-lg-3 brdr_ltgray text-center t-header">
											<imart type="string" id="bunsho_id_label" name="bunsho_id_label" value=$kawari_data.bunsho_id readonly="true" />
											<imart type="imuiTextbox" id="bunsho_id" name="bunsho_id" value=$kawari_data.bunsho_id hidden="true" />
											<imart type="imuiTextbox" id="koushin_bi" name="koushin_bi" value=$kawari_data.koushin_bi hidden="true" escapeXml="true"/>
										</div>
										<div class="col-4 col-lg-2 t-header bg_ltorange brdr_ltgray text-center">ステータス</div>
										<div class="col-5 col-lg-3 brdr_ltgray text-center t-header">											
											<span class='kawari-status pr<imart type="string" value=$kawari_data.kawari_status />'>					
												<imart type="string" value=$kawari_data.kawari_status_name />
											</span>
										</div>
									</div>									
								</div>								
							</div>
							
						<div class="col-12 mt-2 mb-2">
							<div class="row">
								<div class="col-12 col-lg-3">
									<h4 class="indent">基本情報</h4>
								</div>								
							</div>
							<div class="form-group row">
								<div class="col-12 col-lg-6">
									<div class="row">
										<div class="col-4 mb-2 t-header bg_ltorange brdr_ltgray text-center radio_height">タイトル</div>
										<div class="col-8 mb-2 t-header back-color">
											<imart type="string" id="title_nm" name="title_nm" value=$kawari_data.title_nm escapeJs="false" escapeXml="true"  />
											<imart type="imuiTextbox" id="title_nm" name="title_nm" class="form-control imui-text-readonly" value=$kawari_data.title_nm hidden="true" />
										</div>										
									</div>
									<div class="row">
										<div class="col-4 mb-2 t-header bg_ltorange brdr_ltgray text-center radio_height">IP</div>
										<div class="col-8 mb-2 t-header back-color">
											<imart type="string" id="title_nm" name="ip_nm" value=$kawari_data.ip_nm escapeJs="false" escapeXml="true"  />
											<imart type="imuiTextbox" id="ip_nm" name="ip_nm" class="form-control imui-text-readonly" value=$kawari_data.ip_nm hidden="true" />
										</div>		
									</div>									
									<imart type="condition" validity=$viewCtrl.isKyodaku negative>
									<div class="row">
										<div class="col-4 mb-2 t-header bg_ltorange brdr_ltgray text-center">企画種別</div>
										<div class="col-8 mb-2 t-header back-color">
											<imart type="string" id="kikaku_shubetsu_name" name="kikaku_shubetsu_name" value=$kawari_data.kikaku_shubetsu_name escapeJs="false" escapeXml="true"  />											
										</div>
									</div>
									</imart>
									<imart type="condition" validity=$viewCtrl.isKyodaku>
									<div class="row">
										<div class="col-4 mb-2 t-header bg_ltorange brdr_ltgray text-center">許諾種別</div>
										<div class="col-8 mb-2 t-header back-color">
											<imart type="string" id="kyodaku_cls_nm" name="kyodaku_cls_nm" value=$kawari_data.kyodaku_cls_nm escapeJs="false" escapeXml="true"  />
										</div>
									</div>
									</imart>									
								</div>
								<div class="col-12 col-lg-6">
									<div class="row">
										<div class="col-4 mb-2 t-header bg_ltorange brdr_ltgray text-center">申請日</div>
										<div class="col-8 mb-2 t-header back-color">
											<imart type="string" value=$kawari_data.shinsei_bi escapeJs="false" escapeXml="true" />											
										</div>
									</div>									
									<div class="row">
										<div class="col-4 mb-2 t-header bg_ltorange brdr_ltgray text-center">
										<imart type="condition" validity=$viewCtrl.isLicenseProposal negative>
											ライセンシー名
											</imart>
											<imart type="condition" validity=$viewCtrl.isLicenseProposal>
											海外ライセンシー名
										</imart>
										</div>										
										<div class="col-8 mb-2 t-header back-color">										
											<imart type="string" id="kaisha_nm" name="kaisha_nm" value=$kawari_data.kaisha_nm escapeJs="false" escapeXml="true" />
											<imart type="imuiTextbox" id="kaisha_nm" name="kaisha_nm" class="form-control imui-text-readonly" value=$kawari_data.kaisha_nm hidden="true" />
										</div>											
									</div>
									<imart type="decision" value=$bunshoCls case="6">
									<div class="row">
										<div class="col-4 mb-2 t-header bg_ltorange brdr_ltgray text-center">海外販社</div>
										<div class="col-8 mb-2 t-header back-color">
											<imart type="string" id="kaigai_hansha_nm" name="kaigai_hansha_nm" value=$kawari_data.kaigai_hansha_nm escapeJs="false" escapeXml="true" />
										</div>
									</div>
									</imart>
									<imart type="decision" value=$bunshoCls case="5">
									<div class="row">
										<div class="col-4 mb-2 t-header bg_ltorange brdr_ltgray text-center">契約種別</div>
										<div class="col-8 mb-2 t-header back-color">
											<imart type="string" id="keiyaku_cls_nm" name="keiyaku_cls_nm" value=$kawari_data.keiyaku_cls_nm escapeJs="false" escapeXml="true" />
										</div>
									</div>
									</imart>
								</div>
							</div>
							<div class="form-group row">									
								<div class="col-2 mb-2 t-header bg_ltorange brdr_ltgray text-center radio_height">件名</div>
								<div class="col-10 mb-2 t-header back-color" style="overflow-wrap:break-word;">
									<imart type="string" id="bunsho_nm" name="bunsho_nm" value=$kawari_data.bunsho_nm escapeJs="false" escapeXml="true" />
									<imart type="imuiTextbox" id="bunsho_nm" name="bunsho_nm" class="form-control imui-text-readonly" value=$kawari_data.bunsho_nm hidden="true" />
								</div>
							</div>
						</div>
						<imart type="condition" validity=$viewCtrl.isLicenseProposal negative>
						<div class="col-12 mt-2 mb-2">
							<div class="row">
								<div class="col-12 col-lg-3">
									<h4 class="indent">詳細情報</h4>
								</div>								
							</div>
						</div>
						</imart>

						<imart type="condition" validity=$viewCtrl.isKikaku>							
						<div class="row border-bottom">								
							<div class="col-12 mt-2 mb-2 responsive-table-wrapper">
								<table id="kikaku_shohin_table" class="table table_border_radius">
									<thead>
										<tr role="row">
											<th class="bg_ltorange brdr_ltgray col_25 text-center align-middle">#</th>
											<th class="bg_ltorange brdr_ltgray col_200 text-center align-middle">企画商品名</th>												
											<th class="bg_ltorange brdr_ltgray col_150 text-center align-middle">商品カテゴリ</th>
											<th class="bg_ltorange brdr_ltgray col_100 text-center align-middle">発売時期</th>
											<th class="bg_ltorange brdr_ltgray col_100 text-center align-middle" >告知開始<br>時期</th>
											<th class="bg_ltorange brdr_ltgray col_100 text-center align-middle">地域</th>
											<th class="bg_ltorange brdr_ltgray col_100 text-center align-middle">税抜上代</th>
											<th class="bg_ltorange brdr_ltgray col_50 text-center align-middle">料率</th>
											<th class="bg_ltorange brdr_ltgray col_100 text-center align-middle">初回生産<br>予定数</th>
											<th class="bg_ltorange brdr_ltgray col_100 text-center align-middle">目標販売<br>個数</th>
											<th class="bg_ltorange brdr_ltgray col_150 text-center align-middle">ロイヤリティ金額</th>
											
										</tr>
									</thead>
									<tbody>
									</tbody>
								</table>
							</div>								
						</div>
						<div style="height:20px;"></div>
						</imart>
						
						<imart type="condition" validity=$viewCtrl.isKyodaku>							
						<div class="row border-bottom">								
							<div class="col-12 mt-2 mb-2 responsive-table-wrapper">
								<table id="kyodaku_shohin_table" class="table table_border_radius">
									<thead>
										<tr role="row">
											<th class="bg_ltorange brdr_ltgray col_25 text-center align-middle">#</th>
											<th class="bg_ltorange brdr_ltgray col_100 text-center align-middle">商品/<br>販促物</th>
											<th class="bg_ltorange brdr_ltgray col_150 text-center align-middle">商品名</th>
											<th class="bg_ltorange brdr_ltgray col_150 text-center align-middle">発売日</th>
											<th class="bg_ltorange brdr_ltgray col_150 text-center align-middle">税抜上代</span></th>
											<th class="bg_ltorange brdr_ltgray col_100 text-center align-middle">料率</th>
											<th class="bg_ltorange brdr_ltgray col_150 text-center align-middle">使用料<br>（単価）</th>
											<th class="bg_ltorange brdr_ltgray col_125 text-center align-middle">最低保証数<br>（申請数）</th>
											<th class="bg_ltorange brdr_ltgray col_150 text-center align-middle">最低保証料<br>（許諾料）</th>
											<th class="bg_ltorange brdr_ltgray col_125 text-center align-middle">証紙</th>
											<th class="bg_ltorange brdr_ltgray col_125 text-center align-middle">見本数量</th>
											<th class="bg_ltorange brdr_ltgray col_100 text-center align-middle">販売地域</th>
										</tr>
									</thead>
									<tbody>
									</tbody>
								</table>
							</div>							
						</div>
						<div style="height:20px;"></div>
						</imart>

						<div class="col-12 mt-2 mb-2">
							<imart type="condition" validity=$viewCtrl.isKyodaku negative>
								<imart type="condition" validity=$viewCtrl.isLicenseProposal>
								<div class="form-group row">
									<div class="col-12 col-lg-6">
										<div class="row">
											<div class="col-4 mb-2 t-header bg_ltorange brdr_ltgray text-center radio_height">ロイヤリティ金額（現地通貨）</div>
											<div class="col-8 mb-2 t-header back-color text-right">
												<span id="royalty_kingaku_genchi"></span>												
												<imart type="string" id="royalty_kingaku" name="royalty_kingaku" value=$kawari_data.currency_nm escapeJs="false" escapeXml="true" />
											</div>
										</div>									
									</div>
									<div class="col-12 col-lg-3">
										<div class="row">
											<div class="col-4 mb-2 t-header bg_ltorange brdr_ltgray text-center">円換算レート</div>
											<div class="col-8 mb-2 t-header back-color text-right">
												<span id="kawase_rate"></span>円
											</div>
										</div>
									</div>
									<div class="col-12 col-lg-3">
										<div class="row">
											<div class="col-4 mb-2 t-header bg_ltorange brdr_ltgray text-center">配分率</div>
											<div class="col-8 mb-2 t-header text-right back-color">
												<imart type="string" id="royalty_kingaku" name="royalty_kingaku" value=$kawari_data.haibun_rate escapeJs="false" escapeXml="true" />％
											</div>
										</div>
									</div>
								</div>
								</imart>
								<div class="form-group row">
									<div class="col-12 col-lg-6">
										<div class="row">
											<div class="col-4 mb-2 t-header bg_ltorange brdr_ltgray text-center radio_height">ロイヤリティ合計額（税抜き）</div>
											<div class="col-8 mb-2 t-header back-color text-right">
												<span id="royalty_kingaku"></span>円
											</div>
										</div>									
									</div>
									<div class="col-12 col-lg-6">
										<div class="row">
											<div class="col-4 mb-2 t-header bg_ltorange brdr_ltgray text-center">発売時期（開始時期）</div>
											<div class="col-8 mb-2 t-header back-color">
												<imart type="string" id="hatsubai_jiki" name="hatsubai_jiki" value=$kawari_data.hatsubai_jiki escapeJs="false" escapeXml="true" />
											</div>
										</div>
									</div>
								</div>
							</imart>							
							<imart type="decision" value=$bunshoCls case="5">
							<div class="form-group row">
								<div class="col-12 col-lg-4">
									<div class="row">
										<div class="col-6 mb-2 t-header bg_ltorange brdr_ltgray text-center radio_height">合計最低保証数（申請数）</div>
										<div class="col-6 mb-2 t-header text-padding back-color text-right">
											<span id="saiteihosho_su_shinseisu"></span>
											個
										</div>
									</div>									
								</div>
								<div class="col-12 col-lg-4">
									<div class="row">
										<div class="col-6 mb-2 t-header bg_ltorange brdr_ltgray text-center">合計最低保証料（許諾料）</div>
										<div class="col-6 mb-2 t-header text-padding back-color text-right">										
											<span id="saiteihosho_ryo_kyodakuryo"></span>
											円										
										</div>
									</div>
								</div>
								<div class="col-12 col-lg-4">
									<div class="row">
										<div class="col-6 mb-2 t-header bg_ltorange brdr_ltgray text-center">素材費</div>
										<div class="col-6 mb-2 t-header text-padding back-color text-right">
											<span id="sozai_hi"></span>
											円
										</div>
									</div>
								</div>
							</div>
							</imart>
							<imart type="condition" validity=$viewCtrl.isKikaku negative>
							<div class="form-group row">
								<imart type="decision" value=$bunshoCls case="6">
								<div class="col-12 col-lg-6">
									<div class="row">
										
									</div>
								</div>
								</imart>
								<div class="col-12 col-lg-6">
									<div class="row">
										<div class="col-4 mb-2 t-header bg_ltorange brdr_ltgray text-center">許諾期間</div>
										<div class="col-8 mb-2 t-header back-color">
											<imart type="string" id="kyodaku_kikan_from" name="kyodaku_kikan_from" value=$kawari_data.kyodaku_kikan_from escapeJs="false" escapeXml="true" />												
										
										<span class="col-1 mb-2 text-center align-middle pt-2">〜</span>
										
											<imart type="string" id="kyodaku_kikan_to" name="kyodaku_kikan_to" value=$kawari_data.kyodaku_kikan_to escapeJs="false" escapeXml="true" />												
										</div>
										
									</div>
								</div>
								<imart type="decision" value=$bunshoCls case="5">
								<div class="col-12 col-lg-6">
									<div class="row">
										<div class="col-4 mb-2 t-header bg_ltorange brdr_ltgray text-center">発売日</div>
										<div class="col-8 mb-2 t-header text-padding back-color">											
											<imart type="string" id="hatsubai_bi" name="hatsubai_bi" value=$kawari_data.hatsubai_bi escapeJs="false" escapeXml="true" />	
										</div>
									</div>
								</div>	
								</imart>													
							</div>							
							</imart>
							
							<imart type="decision" value=$bunshoCls case="6">
							<div class="form-group row mt-2 mb-2">
								<span class="col-12"><imart type="message" id="KS02I002" escapeJs="true" /></span>
								<span class="col-12"><imart type="message" id="KS02I003" escapeJs="true" /></span>
							</div>
							<div class="form-group row">
								<div class="col-2 mb-2 t-header bg_ltorange brdr_ltgray text-center radio_height">ロイヤリティ金額備考</div>
								<div class="col-10 mb-2 t-header back-color" style="min-height:60px;overflow-wrap:break-word;">
									<imart type="string" id="royalty_kingaku" name="royalty_kingaku" value=$kawari_data.royalty_kingaku_biko escapeJs="false" escapeXml="true" nl2br="true" />
								</div>								
							</div>
							</imart>
							
							<div class="form-group row">
								<div class="col-12">
									<div class="row">
										<div class="col-2 mb-2 t-header bg_ltorange brdr_ltgray text-center radio_height">内容</div>
										<div class="col-10 mb-2 t-header back-color" style="min-height:200px;overflow-wrap:break-word;">
											<imart type="string" id="naiyo" name="naiyo" value=$kawari_data.naiyo escapeJs="false" escapeXml="true" nl2br="true" />
										</div>
									</div>									
								</div>								
							</div>
							<div class="form-group row">
								<div class="col-12">
									<div class="row">
										<div class="col-2 mb-2 t-header bg_ltorange brdr_ltgray text-center radio_height">海外販売の国名及び数量</div>
										<div class="col-10 mb-2 t-header back-color" style="min-height:60px;overflow-wrap:break-word;">
											<imart type="string" id="biko" name="biko" value=$kawari_data.biko escapeJs="false" escapeXml="true" nl2br="true"/>
										</div>
									</div>									
								</div>								
							</div>
						
							<div class="form-group row">
								<div class="col-12 col-lg-6">
									<div class="row">
										<div class="col-4 mb-2 t-header bg_ltorange brdr_ltgray text-center radio_height">公開範囲</div>
										<div class="col-8 mb-2 t-header back-color">
											<imart type="string" id="gokuhi_flg" name="gokuhi_flg" value=$kawari_data.gokuhi_nm escapeJs="false" escapeXml="true" />
										</div>
									</div>									
								</div>								
							</div>
						</div>
						
						<div class="col-12 mt-2 mb-2">
							<div class="row">
								<div class="col-12">
									<h4 class="indent">添付ファイル</h4>
								</div>
							</div>
						</div>						
						
						<div class="col-12">
							<imart type="repeat" list=$fileList item="item" index="idx">
								<div class="mb-2">
									<a class="" href='javascript:void(0);' onclick='fileDownload("<imart type="string" value=item.file_path/>","<imart type="string" value=item.file_name　escapeXml="true"/>");'>
										<imart type="string" value=item.file_name escapeJs="false" escapeXml="true" />
									</a>
								</div>
							</imart>
						</div>						

						<div class="col-12 mt-2 mb-2">
							<div class="row">
								<div class="col-12 col-lg-3">										
									<h4 class="indent">関連文書</h4>
								</div>
							</div>
						</div>
						<div class="row">
							<div class="col-12 mt-2 mb-2 responsive-table-wrapper">
								<table id="kanren_bunsho_table" class="table table_border_radius">
									<thead>
										<tr role="row">
											<th class="bg_ltorange brdr_ltgray col_100 text-center align-middle">文書番号</th>
											<th class="bg_ltorange brdr_ltgray col_225 text-center align-middle">文書種別</th>
											<th class="bg_ltorange brdr_ltgray col_150 text-center align-middle">件名</th>												
										</tr>
									</thead>
									<tbody>
									</tbody>
								</table>
							</div>								
						</div>
						
						<imart type="condition" validity=$viewCtrl.isKikaku> <!-- 企画のみ -->						
						<div id="shohyo_input_area" class="licensee-hide col-12 bg_ltblue">
							<div class="col-12 row"><h4 class="indent">簡易商標調査担当入力欄</h4></div>
							<div class="row">
								<div class="col-12">
									<div class="row">
										<div class="col-2 mb-2 t-header bg_ltorange brdr_ltgray lo-center">簡易商標調査結果</div>
										<div class="shohyo-hide col-2 mb-2 t-header bg-white">
											<imart type="string" value=$kawari_data.shohyo_chosa_kekka_nm />
										</div>
										<div class="shohyo-show col-2 mb-2 t-header back-color">
											<imart type="imuiSelect" class="form-control full_width" id="shohyo_chosa_kekka" name="shohyo_chosa_kekka" list=$shohyo_kekka_list />
										</div>
									</div>
									<div class="row">
										<div class="col-2 mb-2 t-header bg_ltorange brdr_ltgray lo-center">簡易商標調査コメント</div>
										<div class="shohyo-hide col-6 mb-2 t-header bg-white">
											<imart type="string" value=$kawari_data.shohyo_chosa_comment nl2br="true" escapeJs="false" escapeXml="true" />
										</div>
										<div class="shohyo-show col-6 mb-2 t-header back-color">
											<imart type="imuiTextArea" id="shohyo_chosa_comment" name="shohyo_chosa_comment" value=$kawari_data.shohyo_chosa_comment rows="12" width="100%" maxlength="10000"/>
										</div>
									</div>
								</div>
							</div>
							<IMART type="condition" validity=$shohyo_group_flg>
							<div class="col-12 pt-2 pb-2 text-center">
								<button type="button" class="bg_orange txt_dark" id="btn_save_shohyo_kekka"><i class="fas fa-check-circle fa-2x"></i><span>簡易商標調査担当入力欄保存</span></button>
							</div>
							</IMART>
						</div>
						</imart>						
						
						<imart type="condition" validity=$viewCtrl.routeFlg>
						<div class="col-12 mt-2 mb-2">
							<div class="row">
								<div class="col-12 col-lg-3">										
									<h4 class="indent">経路</h4>
								</div>
							</div>
						</div>
						<div class="col-12 mt-2 mb-2">
							<div class="node-list row">								
									<div class="node-name t-header bg_ltorange brdr_ltgray lo-center">入力者</div>									
								
									<div class="node-name t-header bg_ltorange brdr_ltgray lo-center">起案者</div>
								
									<div class="node-name t-header bg_ltorange brdr_ltgray lo-center">承認者１</div>
								
									<div class="node-name t-header bg_ltorange brdr_ltgray lo-cente">承認者２</div>
								
									<div class="node-name t-header bg_ltorange brdr_ltgray lo-cente">承認者３</div>
								
									<div class="node-name t-header bg_ltorange brdr_ltgray lo-cente">承認者４</div>
								
									<div class="node-name t-header bg_ltorange brdr_ltgray lo-cente">承認者５</div>
								
									<div class="node-name t-header bg_ltorange brdr_ltgray lo-cente">完了確認者</div>
						
							</div>
							<div class="row node-list">
									<div class="node-tanto pt-2 pb-2<imart type="condition" validity=$nodeUserslist.apply.execFlg> back-color</imart>">
									<imart type="string" value=$nodeUserslist.apply.userName escapeJs="false" escapeXml="true" />
									</div>
									<div class="node-tanto pt-2 pb-2<imart type="condition" validity=$nodeUserslist.kian.execFlg> back-color</imart>">
										<imart type="string" value=$nodeUserslist.kian.userName escapeJs="false" escapeXml="true" />
									</div>
									<div class="node-tanto pt-2 pb-2<imart type="condition" validity=$nodeUserslist.appr_1.execFlg> back-color</imart>"><imart type="string" value=$nodeUserslist.appr_1.userName escapeJs="false" escapeXml="true" /></div>
								
									<div class="node-tanto pt-2 pb-2<imart type="condition" validity=$nodeUserslist.appr_2.execFlg> back-color</imart>"><imart type="string" value=$nodeUserslist.appr_2.userName escapeJs="false" escapeXml="true" /></div>
								
									<div class="node-tanto pt-2 pb-2<imart type="condition" validity=$nodeUserslist.appr_3.execFlg> back-color</imart>"><imart type="string" value=$nodeUserslist.appr_3.userName escapeJs="false" escapeXml="true" /></div>
								
									<div class="node-tanto pt-2 pb-2<imart type="condition" validity=$nodeUserslist.appr_4.execFlg> back-color</imart>"><imart type="string" value=$nodeUserslist.appr_4.userName escapeJs="false" escapeXml="true" /></div>
								
									<div class="node-tanto pt-2 pb-2<imart type="condition" validity=$nodeUserslist.appr_5.execFlg> back-color</imart>"><imart type="string" value=$nodeUserslist.appr_5.userName escapeJs="false" escapeXml="true" /></div>
								
									<div class="node-tanto pt-2 pb-2<imart type="condition" validity=$nodeUserslist.last_confirm.execFlg> back-color</imart>"><imart type="string" value=$nodeUserslist.last_confirm.userName escapeJs="false" escapeXml="true" /></div>						
							</div>
						</div>
						
						<div class="row mt-2 mb-2">
						<div class="col-12">
							<h4>通知先</h4>
							<div class="col-8 row">
								<div class="node-name col-2 t-header bg_ltorange brdr_ltgray lo-center">起案時通知先</div>
								<div class="node-name col-2 t-header bg_ltorange brdr_ltgray lo-center">完了通知先</div>
								<div class="node-name col-2 t-header bg_ltorange brdr_ltgray lo-center">契約担当</div>
								<div class="node-name col-2 t-header bg_ltorange brdr_ltgray lo-center">計上担当</div>
							</div>
							<div class="col-8 row">
								<div class="node-name col-2 brdr_ltgray pt-1 pb-1">
									<ul class="mb-0">
									<imart type="repeat" list=$mailDefUsers.mail_1 item="item" index="idx">
										<li class="pt-1"><imart type="string" value=item.user_name escapeJs="false" escapeXml="true" /></li>
									</imart>
									</ul>
								</div>
								<div class="node-name col-2 brdr_ltgray pt-1 pb-1">
									<ul class="mb-0">
									<imart type="repeat" list=$mailDefUsers.mail_3 item="item" index="idx">
										<li class="pt-1"><imart type="string" value=item.user_name escapeJs="false" escapeXml="true" /></li>
									</imart>
									</ul>
								</div>
								<div class="node-name col-2 brdr_ltgray pt-1 pb-1">
									<ul class="mb-0">
									<imart type="repeat" list=$mailDefUsers.mail_4 item="item" index="idx">
										<li class="pt-1"><imart type="string" value=item.user_name escapeJs="false" escapeXml="true" /></li>
									</imart>
									</ul>
								</div>
								<div class="node-name col-2 brdr_ltgray pt-1 pb-1">
									<ul class="mb-0">
									<imart type="repeat" list=$mailDefUsers.mail_5 item="item" index="idx">
										<li class="pt-1"><imart type="string" value=item.user_name escapeJs="false" escapeXml="true" /></li>
									</imart>
									</ul>
								</div>
							</div>
						</div>
						</div>
						</imart>
						<div id="commentArea" class="row not-print-area">
							<div class="col-12">
								<h4>コメント</h4>								
								<imart type="include" page="lo/contents/screen/common/comment" ticketId=$kawari_data.bunsho_id tempFileNoDisp=true ></imart>
							</div>
						</div>

						<!-- エラー表示エリア -->
						<div class="row">
							<div id="error-messages" class="col-12 mt-4 mb-2">
							</div>
						</div>
						
						<div class="ml-4 not-print-area">
							<button type="button" class="brdr_orange txt_orange p-3 mb-2" onclick="moveToPageTop(100);">
								▲ページ先頭へ戻る
							</button>
						</div>							

						<div class="not-print-area">
	
							<div class="col-12 row mt-4 mb-2">
								<div class="flex_btn">
									<div class="col-12">
										<button type="button" id="btn_syusei" class="bg_orange txt_dark" style="display:none;" onclick="location.href='./lo/contents/screen/kawari/kawari_register?bunsho_id=' + $('#bunsho_id').val();">
											<i class="fas fa-pen fa-2x"></i><span>編集</span>
										</button>
										<imart type="condition" validity=$before_apply>
											<button type="button" id="btn_apply" class="bg_orange txt_dark" style="display:none;">
												<i class="fas fa-check-circle fa-2x"></i><span><imart type="string" value=$action_name escapeJs="false" escapeXml="true" /></span>
											</button>
											<button type="button" id="btn_re_apply" class="bg_orange txt_dark" style="display:none">
											<i class="fas fa-check-circle fa-2x"></i><span><imart type="string" value=$action_name escapeJs="false" escapeXml="true" /></span>
											</button>
										</imart>
										<imart type="condition" validity=$viewCtrl.pullback_enable_flg>
											<button type="button" id="btn_torimodosi" class="bg_blue txt_dark">
											<i class="fas fa-check-circle fa-2x"></i><span>取戻</span>
											</button>
											<IMART type="hidden" pullback_param=$pullbackParam　escapeXml="true" escapeJs="true" />	
										</imart>
										<imart type="condition" validity=$proc_user_flg>			
											<imart type="decision" value=$wf_data.imwNodeId case="lo_node_kian">		
												<button type="button" class="bg_blue txt_dark" data-toggle="modal" data-target="#modal-comment-input" data-backdrop="static" id="btn_syusei_irai" data-whatever="btn_syusei_irai">
													<i class="fas fa-check-circle fa-2x"></i><span>修正依頼</span>
												</button>
											</imart>
											<imart type="decision" value=$wf_data.imwNodeId case="lo_node_kian">											
												<button type="button" class="bg_orange txt_dark" data-toggle="modal" data-target="#modal-comment-input" data-backdrop="static" id="btn_kian" data-whatever="btn_kian">
													<i class="fas fa-check-circle fa-2x"></i><span>起案</span>
												</button>
											</imart>										
											<imart type="condition" validity=$approve_flg>
												<button type="button" class="bg_blue txt_dark" data-toggle="modal" data-target="#modal-comment-input" data-backdrop="static" id="btn_sasimodosi" data-whatever="btn_sasimodosi" >
													<i class="fas fa-check-circle fa-2x"></i><span>差戻</span>
												</button>
												<button type="button" class="bg_orange txt_dark" data-toggle="modal" data-target="#modal-comment-input" data-backdrop="static" id="btn_shonin" data-whatever="btn_shonin">
													<i class="fas fa-check-circle fa-2x"></i><span>承認</span>
												</button>
											</imart>
											<imart type="decision" value=$wf_data.imwNodeId case="lo_node_last_confirm">
												<button type="button" class="bg_orange txt_dark" data-toggle="modal" data-target="#modal-comment-input" data-backdrop="static" id="btn_kanryo" data-whatever="btn_kanryo">
													<i class="fas fa-check-circle fa-2x"></i><span>完了</span>
												</button>
											</imart>
										</imart>										
									</div>
								</div>
							</div>
							
						</div>
					
					</section>
				</article>
				<div>
					<article>
						<section class="show">
							<footer class="text-center mt-4 mb-2"></footer>
						</section>
					</article>
				</div>

			<!-- main contents -->
			
			<div class="popup" id="js-popup">
				<div class="popup-inner2">
					<div class="close-btn" id="js-close-btn"><i class="fas fa-times"></i></div><br>
					<imart type="include" page="lo/contents/screen/common/ip_search" mode="radio"></imart>
				</div>
				<div class="black-background" id="js-black-bg"></div>
			</div>
			
			<div class="popup" id="js-popup2">
				<div class="popup-inner2">
					<div class="close-btn" id="js-close-btn2"><i class="fas fa-times"></i></div><br>
					<imart type="include" page="lo/contents/screen/common/title_search" mode="radio"></imart>
				</div>
				<div class="black-background" id="js-black-bg2"></div>
			</div>
			<div class="popup" id="js-popup3">
				<div class="popup-inner2">
					<div class="close-btn" id="js-close-btn3">
						<i class="fas fa-times"></i>
					</div>
					<br>
					<imart type="include" page="lo/contents/screen/common/kaisha_search" mode="radio"></imart>
				</div>
			<div class="black-background" id="js-black-bg3"></div>
	</div>
		</div>
	</div>
	<form id="filesForm" name="filesForm" action="ui/filer/upload" method="POST" enctype="multipart/form-data">
		<div style="display:none;">
			<!-- ストレージサービスへのファイルのアップロード（IM標準） -->
			<imart type="imuiFileUpload" storeTo="/lo/upload"
				autoUpload="true" uniqueFileName="true" id="imui-upload"
				onBeforeSend="onBeforeSendFiles" 
				onSuccess="onSuccessFiles"
				onError="onErrorFiles" 
				outerFormId="filesForm"
				dropZone="#before_file_select" />
				<imst:imSecureToken />
		</div>
	</form>

	<script type="text/javascript">
		// ステータス取得
		var kawari_status = '<imart type="string" value=$kawari_data.kawari_status />';	
			
		// 許諾申請上限取得
		var kyodaku_shinsei_max = <imart type="number" value=$kyodakuShinseiMax />;

		var validationErrorMessages = <imart type="string" value=$validationErrorMessages />;
		function validate() {
			/*
			var validationRules = [
				{type: "single", dataCategory: "plan",
					items: []
   				},
				{type: "grid", dataCategory: "permission",  rowSelector: "#moto_kyodaku_table tbody tr",
					items: []
   				},
				{type: "single", dataCategory: "basic",
					items: [
						{selectorType: "name", name: "kyodaku_nm", validations:[{type: "required", messageId: "KY02E001"}]},
						{selectorType: "name", name: "shinsei_bi", validations:[{type: "required", messageId: "KY02E002"}]},
						{selectorType: "name", name: "shinsei_bi", validations:[{type: "calender", messageId: "KY02E028"}]}
				 	]
				},
				{type: "grid", dataCategory: "goods",  rowSelector: "#kyodaku_shohin_table tbody tr",
					items: [
						{selectorType: "name", name: "shohin_mei", validations:[{type: "required", messageId: "KY02E003"}]},
						{selectorType: "name", name: "hatsubai_bi", validations:[{type: "required", messageId: "KY02E004"}]},
						{selectorType: "name", name: "hatsubai_bi", validations:[{type: "calender", messageId: "KY02E029"}]},
						{selectorType: "name", name: "zeinuki_jodai", validations:[{type: "required", messageId: "KY02E005"}]},
						{selectorType: "name", name: "zeinuki_jodai", validations:[{type: "num5", messageId: "KY02E015"}]},
						{selectorType: "name", name: "zeinuki_jodai", validations:[{type: "space", messageId: "KY02E036"}]},
						{selectorType: "name", name: "ryoritsu", validations:[{type: "required", messageId: "KY02E006"}]},
						{selectorType: "name", name: "ryoritsu", validations:[{type: "num", messageId: "KY02E016"}]},
						{selectorType: "name", name: "ryoritsu", validations:[{type: "space", messageId: "KY02E037"}]},
						{selectorType: "name", name: "saiteihosho_su_shinseisu", validations:[{type: "required", messageId: "KY02E008"}]},
						{selectorType: "name", name: "saiteihosho_su_shinseisu", validations:[{type: "nat", messageId: "KY02E018"}]},
						{selectorType: "name", name: "saiteihosho_su_shinseisu", validations:[{type: "space", messageId: "KY02E039"}]},
						{selectorType: "name", name: "shoshi", validations:[{type: "required", messageId: "KY02E010"}]},
						{selectorType: "name", name: "mihon_suryo", validations:[{type: "nat", messageId: "KY02E020"}]},
						{selectorType: "name", name: "mihon_suryo", validations:[{type: "space", messageId: "KY02E041"}]}
				 	]
				},
				{type: "single", dataCategory: "goods",  rowSelector: "#kyodaku_shohin_table tbody tr",
					items: [
						{selectorType: "name", name: "hatsubai_bi", validations:[{type: "individual", messageId: "KY02E032"}]}
				 	]
				},
				{type: "single", dataCategory: "permission",
					items: [
						{selectorType: "name", name: "sozai_hi", validations:[{type: "nat", messageId: "KY02E048"}]},
						{selectorType: "name", name: "sozai_hi", validations:[{type: "space", messageId: "KY02E049"}]},
						{selectorType: "name", name: "kyodaku_kikan_from", validations:[{type: "required", messageId: "KY02E011"}]},
						{selectorType: "name", name: "kyodaku_kikan_to", validations:[{type: "required", messageId: "KY02E011"}]},
						{selectorType: "name", name: "kyodaku_kikan_to", validations:[{type: "calender_from", messageId: "KY02E035"}]},
						{selectorType: "name", name: "saiteihosho_kigen", validations:[{type: "required", messageId: "KY02E033"}]},
						{selectorType: "name", name: "saiteihosho_kigen", validations:[{type: "calender", messageId: "KY02E034"}]}
				 	]
				}
			];
			
			
			if (kyodaku_cls == "1") {
				validationRules[0].items.push({selectorType: "name", name: "kikaku_id", validations:[{type: "required", messageId: "KY02E012"}, {type: "unique", messageId: "KY02E014"}]});
				validationRules[0].items.push({selectorType: "name", name: "ip_cd", validations:[{type: "simplex", messageId: "KY02E013"}]});
			} else {
				validationRules[1].items.push({selectorType: "name", name: "moto_bunsho_id", validations:[{type: "required", messageId: "KY02E047"}]});
			}
			if (kawari_status == '3') {
				validationRules[4].items.push({selectorType: "name", name: "biko", validations:[{type: "required", messageId: "KY02E030"}]});
			}
			
			var natNgList = chkInputNatOnly();
			var numNgList = chkInputNumOnly();
			var spaceNgList = chkInputSpace();
			
			var validateItem = function(itemName, $item, validations, index) {
				var result = [];
				if ($item.is(':disabled')) {
					return result;
				}
				for (var validationIndex in validations) {
					var validation = validations[validationIndex];
					var messageId = null;
					if (validation.type == "required") {
						if ($item.is(":radio") || $item.is(":checkbox")) {
							var checked = false;
							$item.each(function(index, element) {
								var $element = $(element);
								if ($element.is(":checked")) {
									checked = true;
									return false;
								}
							});
							if (checked == false) {
								messageId = validation.messageId;
							}
						} else {
							if ($item.length == 0 || $item.val() == '') {
								messageId = validation.messageId;
							}
						}
					}
					if (validation.type == "simplex" || validation.type == "unique") {
						var uniqueArray = [];
						$item.each(function(index, element) {
							var $element = $(element);
							if (uniqueArray.indexOf($element.val()) < 0) {
								uniqueArray.push($element.val());
							}
						});
						if (validation.type == "unique") {
							if ($item.length != uniqueArray.length) {
								messageId = validation.messageId;
							}
						}
						if (validation.type == "simplex") {
							if (uniqueArray.length > 1) {
								messageId = validation.messageId;
							}
						}
					}
					if (validation.type == "nat") {
						if(natNgList.indexOf($item[0]) >= 0) messageId = validation.messageId;
					}
					if (validation.type == "num") {
						if(numNgList.indexOf($item[0]) >= 0) messageId = validation.messageId;
					}
	                if (validation.type == "num5") {
	                    if(numNgList.indexOf($item[0]) >= 0) messageId = validation.messageId;
	                    var zeinuki_jodai_1 = $item.val() ? parseFloat(convertWideToHalf($item.val()).replace(/,/g, '')) : 0;
	                    var zeinuki_jodai_2 = parseFloat(zeinuki_jodai_1.toFixed(5));
	                    if(zeinuki_jodai_1 != zeinuki_jodai_2) messageId = validation.messageId;
	                }
					if (validation.type == "space") {
						if(spaceNgList.indexOf($item[0]) >= 0) messageId = validation.messageId;
					}
					if (validation.type == "calender") {
						if (!$item.val() == '' && !$item.val().match(/^(\d+)\/(\d+)\/(\d+)$/)) {
	                		messageId = validation.messageId;
	                	}
	                }
					if (validation.type == "calender_from") {
	                	let kyodaku_kikan_from = $("[name=kyodaku_kikan_from]") ? parseInt($("[name=kyodaku_kikan_from]").val().replace(/\//g, "").replace(/,/g, '')) : 0;
	                	let kyodaku_kikan_to = $("[name=kyodaku_kikan_to]") ? parseInt($("[name=kyodaku_kikan_to]").val().replace(/\//g, "").replace(/,/g, '')) : 0;
	                	if (kyodaku_kikan_from != 0 && kyodaku_kikan_to != 0) {
	                		if (kyodaku_kikan_to < kyodaku_kikan_from) {
		                		messageId = validation.messageId;
		                	}
	                	}
	                }
					if (validation.type == "individual") {
	                    if (itemName == "hatsubai_bi") {
	                    	var listHatsubaiYM = [];
	                    	$("[name=hatsubai_bi]").each(function() {
	                    		listHatsubaiYM.push($(this).val().substr(0,7));
	                    	});
	                    	if(Array.from(new Set(listHatsubaiYM)).length > 1) {
	                    		messageId = validation.messageId;
	                    	}
	                    }
					}
					if (messageId != null) {
						var errorMessage = validationErrorMessages[messageId];
						if (typeof index != "undefined") {
							errorMessage = errorMessage.replace("{0}", "#" + (index + 1));
						}
						result.push({itemName: itemName, type: validation.type, messageId: messageId, errorMessage:　errorMessage});
						break;
					}
				}
				return result;
			}

			var validateItems = function($container, items, index) {
				var allResult = [];
				for (var itemKey in items) {
					var validationItem = items[itemKey];
					var selectorType = validationItem.selectorType;
					var itemName = validationItem.name;
					var validations = validationItem.validations;
					var $item = $container.find(selectorType == 'class' ? '.' + itemName : '[name="' + itemName + '"]');
					var result = validateItem(itemName, $item, validations, index);
					allResult = allResult.concat(result);
				}
				return allResult;
			}

			var validateResult = {
				isError: false,
				itemResults: []
			};
			for (var typeKey in validationRules) {
				var ruleType = validationRules[typeKey];
				if (ruleType.type == 'grid') {
					var $rows = $(ruleType.rowSelector);
					$rows.each(function(index, element) {
						var $row = $(element);
						var result = validateItems($row, ruleType.items, index);
						validateResult.itemResults = validateResult.itemResults.concat(result);
					});
				} else {
					var $body = $("body");
					var result = validateItems($body, ruleType.items);
					validateResult.itemResults = validateResult.itemResults.concat(result);
				}
			}
			if (validateResult.itemResults.length > 0) {
				validateResult.isError = true;
			}
			return validateResult;
			*/
		}
		
		
		function validateAndShowMessage() {
			/*
			var $errorMessages = $("#error-messages");
			$errorMessages.empty();
			var validateResult = validate();
			if (validateResult.isError == false) {
				document.getElementById("save_btn").disabled = false;
				return validateResult;
			}
			var showMessages = [];
			validateResult.itemResults.forEach(function(currentValue, index, array){
				if (showMessages.indexOf(currentValue.errorMessage) < 0) {
					showMessages.push(currentValue.errorMessage);
				}
			});
			for (var index in showMessages) {
				var message = showMessages[index];
				var messageHtml = '<div class="mark-req">' + message + '</div>';
				$errorMessages.append(messageHtml);
			}
			validateResult.showMessages = showMessages;
			
			// ボタン非活性化
			if (showMessages.length > 0){
				document.getElementById("save_btn").disabled = true;
			}
			
			return validateResult;
			*/
		}
		
		
		/**
		 * HTML ID 属性作成関数
		 */
		var nodeId = 0;
		function generateNodeId() {
			return "generate_node_id_" + String(++nodeId);
		}

		/**
		 * 発売年月日カレンダー用HTML文字列作成関数
		 */
		function generateHatsubaiBiHtml(data) {
			var nodeId = generateNodeId();
			var imuiCalendarScriptHtml = $("#imuiCalendar-template").html().replace('replaceTemplateId', nodeId);
			var html = '';
			html += '<div class="input-group pl-1 pr-1">';
			html += '<input type="text" class="form-control form-control-sm input-date kyodaku_shohin_data require calender" id="' + nodeId +'" name="hatsubai_bi" maxlength="10" value="'+ data + '" style="width: 80px;">';
			html += imuiCalendarScriptHtml;
			html += '<span class="input-group-append"><span class="input-group-text pl-2 pr-2"><i class="fa fa-calendar"></i></span></span>';
			html += '</div>';
			html += '<script type="text/javascript">$("#' + nodeId + '").next("img").hide();' + '<\/script>';
			return html;
		}

		function generateHanbaiChiikiOptionHtml(data) {
			var optionHtml = $('#select-template select[name="hanbai_chiiki"]').html();
			return optionHtml.replace('value="' + data + '"', 'value="' + data + '" selected');
		}
		function generateShoshiOptionHtml(data) {
			var optionHtml = $('#select-template select[name="shoshi"]').html();
			return optionHtml.replace('value="' + data + '"', 'value="' + data + '" selected');
		}
		function generateShohinHansokubutsuOptionHtml(data) {
			var optionHtml = $('#select-template select[name="shohin_hansokubutsu_hanbetsu"]').html();
			return optionHtml.replace('value="' + data + '"', 'value="' + data + '" selected');
		}

		var clickedElm = null;
		
		$(window).on('load', function() {
			document.getElementById('body').style.display = 'block';
			$(".imui-calendar").next("img").hide();
			
			$("#example_length").hide();
			$(".bg_ltorange").css('width','');
			$(".planList").css('max-height', '100%');
			$(".planList thead, .planList tbody").css('display', 'table-row-group');
		});

		/**
		 * 数値カンマ付与関数
		 */
		function addComma(num) {
		    var s = String(num).split('.');
		    var ret = String(s[0]).replace( /(\d)(?=(\d\d\d)+(?!\d))/g, '$1,');
		    if (s.length > 1 && s[1].length > 0) {
		        ret += '.' + s[1];
		    }
		    return ret;
		}

		/**
		 * カンマ除去関数
		 */
		function removeComma(val) {
			if (typeof val != "undefined") {
				return val.split(',').join('');
			} else {
				return "0";
			}
		}

		/* THATS_RIGHTS-1415にて一旦廃止
		function calculateKyodakuKikanToAndSaiteihoshoKigen() {
			var $kyodakuKikanFrom = $("#kyodaku_kikan_from");
			if ($kyodakuKikanFrom.val() == '') {
				return;
			}
			// 許諾期間（開始）年月の１日 + 1年 - 1日
			$("#kyodaku_kikan_to").val(moment($kyodakuKikanFrom.val()).set('date', 1).add({years : 1}).add({days : -1}).format('YYYY/MM/DD'));
			// 許諾期間（開始）年月の１日 + 2カ月 - 1日
			$("#saiteihosho_kigen").val(moment($kyodakuKikanFrom.val()).set('date', 1).add({months : 2}).add({days : -1}).format('YYYY/MM/DD'));
		}
		*/

		function calculateSaiteihosho() {
			var sum_saiteihosho_su_shinseisu = '';
			var sum_saiteihosho_su_kyodakuryo = '';
			$('#kyodaku_shohin_table tbody tr').each(function(index, element){
				var $tr = $(element);
				var $saiteihosho_su_shinseisu = $tr.find("[name='saiteihosho_su_shinseisu']");
				var $saiteihosho_su_kyodakuryo = $tr.find("[name='saiteihosho_su_kyodakuryo']");
				if ($.isNumeric(removeComma(convertWideToHalf($saiteihosho_su_shinseisu.val())))) {
					if (sum_saiteihosho_su_shinseisu == '') {
						sum_saiteihosho_su_shinseisu = 0;
					}
					sum_saiteihosho_su_shinseisu += Number(removeComma(convertWideToHalf($saiteihosho_su_shinseisu.val())));
				}
				if ($.isNumeric(removeComma(convertWideToHalf($saiteihosho_su_kyodakuryo.val())))) {
					if (sum_saiteihosho_su_kyodakuryo == '') {
						sum_saiteihosho_su_kyodakuryo = 0;
					}
					sum_saiteihosho_su_kyodakuryo += Number(removeComma(convertWideToHalf($saiteihosho_su_kyodakuryo.val())));
				}
			});
			$("#goukei_saiteihosho_su_shinseisu").val(addComma(sum_saiteihosho_su_shinseisu));
			$("#goukei_saiteihosho_su_kyodakuryo").val(addComma(sum_saiteihosho_su_kyodakuryo));
		}

//-------------------------------------------------------------------------------------------------------
		// 項目定義
		var ret;		
		var shohinDataSet = [];
		var shohinDataTable;
		
		var bunsho_id;
		var whereParam;	

//-------------------------------------------------------------------------------------------------------
		// 項目初期値
		function initItem() {
	
			// 新規ウィンドウで開いた場合は、戻るボタンを非表示
			var newWindowParam = '';
			<IMART type="condition" validity=$new_window_flg >
				$('#history_back_button').hide();
				newWindowParam = '&new_window_flg=1';
			</IMART>
			// URLにパラメータを付与
			var bunsho_id = '<imart type="string" value=$kawari_data.bunsho_id />';
			let crntUrl = window.location.pathname;
			let crntParamIdx = crntUrl.indexOf('?');
			if(crntParamIdx > 0) crntUrl = crntUrl.substring(0,crntParamIdx);
			window.history.replaceState(null,null,crntUrl + '?bunsho_id=' + bunsho_id + newWindowParam);

			if (kawari_status == "1") {
				$('#delete_btn').show();
				$('#btn_syusei').show();
				
				if($("#imwNodeId").val() == "lo_node_apply"){//引き戻し時ここに入る
					$('#btn_syusei').show();
					$('#btn_re_apply').show();
				}else{
					$('#btn_apply').show();
				}
				
				$('#msg_before_teisyutu').show();
			
				$("#annotation_biko").show();
				$('#ichizi_bikou').hide();
				$('#syuusei_bikou').show();
				$('#biko').addClass('require');
				$('#btn_jitai').show();
			} else if (kawari_status == "3") {//修正依頼
				<imart type="condition" validity=$proc_user_flg>
				// 提出（再申請）、修正ボタン非表示
				$('#btn_syusei').show();
				$('#btn_re_teisyutu').show();
				$('#btn_jitai').show();
				$('#msg_before_teisyutu').show();
				</imart>			
			} else if (kawari_status == "2") {//受付中
				<imart type="condition" validity=$proc_user_flg>
					$('#btn_syusei').show();
				</imart>	
			} else if (kawari_status == "5") {//差し戻し
				<imart type="condition" validity=$proc_user_flg>
				$('#btn_syusei').show();
				$('#delete_btn').show();
				
				if($("#imwNodeId").val() == "lo_node_apply"){
					$('#btn_re_apply').show();
				}
				
				</imart>
			}
			
			whereParam = {"bunsho_id":bunsho_id};			
			
			// 商標調査グループ用の項目の初期設定
			$('.shohyo-show').hide();
			<imart type="condition" validity=$viewCtrl.isKikaku> <!-- 企画のみ -->
			<imart type="condition" validity=$shohyo_group_flg>
				$('.shohyo-hide').hide();
				$('#shohyo_input_area').show();
				$('.shohyo-show').show();
				
				// 簡易商標調査結果 初期選択値
				var shoshi_kekka_select = document.getElementById("shohyo_chosa_kekka");
				var shoshi_kekka_value = "<imart type="string" value=$kawari_data.shohyo_chosa_kekka />"
				if(shoshi_kekka_value == '1') {
					shoshi_kekka_select.options[1].selected = true;
				} else if(shoshi_kekka_value == '2') {
					shoshi_kekka_select.options[2].selected = true;
				} else {
					shoshi_kekka_select.options[0].selected = true;
				}
			</imart>
			</imart>
			
			// ロイヤリティ金額現地（カンマ区切り）
			var royalty_kingaku_genchi = '<imart type="string" value=$kawari_data.royalty_kingaku_genchi escapeJs="false" escapeXml="true" />';
			$("#royalty_kingaku_genchi").text(addComma(Number(royalty_kingaku_genchi)));
			
			// 円換算レート（カンマ区切り）
			var kawase_rate = '<imart type="string" value=$kawari_data.kawase_rate escapeJs="false" escapeXml="true" />';
			$("#kawase_rate").text(addComma(Number(kawase_rate)));
			// ロイヤリティ金額（カンマ区切り）
			var royalty_kingaku = '<imart type="string" value=$kawari_data.royalty_kingaku escapeJs="false" escapeXml="true" />';
			$("#royalty_kingaku").text(addComma(Number(royalty_kingaku)));
			
			// 最低保証数
			var saiteihosho_su = '<imart type="string" value=$kawari_data.saiteihosho_su_shinseisu escapeJs="false" escapeXml="true" />';
			$("#saiteihosho_su_shinseisu").text(addComma(saiteihosho_su));
			
			// 最低保証料
			var saiteihosho_ryo = '<imart type="string" value=$kawari_data.saiteihosho_ryo_kyodakuryo escapeJs="false" escapeXml="true" />';
			$("#saiteihosho_ryo_kyodakuryo").text(addComma(Number(saiteihosho_ryo)));
			
			// 素材費
			var sozai_hi = '<imart type="string" value=$kawari_data.sozai_hi escapeJs="false" escapeXml="true" />';
			$("#sozai_hi").text(addComma(Number(sozai_hi)));
			
		}		

		$(function () {
			bunsho_id = $.trim($("[name='bunsho_id']").val());				

			// 項目初期値
			initItem();
			
			// 検索条件取得
			var whereParam = {
				"bunsho_id":$.trim($("[name=bunsho_id]").val())
			};
			
			var ret;
			var ret2;
			var ret3;
			
			// 検索
			try {
				ret = jsspRpcKawariDetail.retrieveKanrenbunshoList(whereParam);
				ret2 = jsspRpcKawariDetail.retrieveKikakuShohinList(whereParam);
				ret3 = jsspRpcKawariDetail.retrieveKyodakuShohinList(whereParam);
		    } catch (ex) {
		    	imuiShowErrorMessage(ex.message, [], true, 5000, true);
		        return;
		    }
			var kanrenbunshoDataSet = [];
			var kikakuShohinDataSet = [];
			var kyodakuShohinDataSet = [];

			if (ret.countRow > 0) {
				// data配列を順に処理
				$.each(ret.data,function(index, elem) {
					kanrenbunshoDataSet.push({
						kanren_bunsho_id: elem.kanren_bunsho_id == null ? '' : elem.kanren_bunsho_id
						, bunsho_cls: elem.bunsho_cls == null ? '' : elem.bunsho_cls
						, bunsho_cls_nm: elem.bunsho_cls_nm == null ? '' : elem.bunsho_cls_nm
						, bunsho_nm: elem.bunsho_nm == null ? '' : elem.bunsho_nm									
					});
				});
			}	
			
			if (ret2.countRow > 0) {
				// data配列を順に処理
				$.each(ret2.data,function(index, elem) {
					kikakuShohinDataSet.push({
						//kyodaku_shohin_check: false
						 bunsho_edaban: elem.bunsho_edaban == null ? '' : elem.bunsho_edaban
						,shohin_category: elem.shohin_category_nm == null ? '' : elem.shohin_category_nm
						, shohin_nm: elem.shohin_nm == null ? '' : elem.shohin_nm
						, hanbai_jiki: elem.hanbai_jiki == null ? '' : elem.hanbai_jiki
						, kokuchi_kaishi_jiki: elem.kokuchi_kaishi_jiki == null ? '' : elem.kokuchi_kaishi_jiki
						, zeinuki_jodai: elem.zeinuki_jodai == null ? '' : addComma(elem.zeinuki_jodai)
						, ryoritsu: elem.ryoritsu == null ? '' : elem.ryoritsu
						, siyoryo: elem.siyoryo == null ? '' : addComma(elem.siyoryo)
						, shokai_seisanyotei_su: elem.shokai_seisanyotei_su == null ? '' : addComma(elem.shokai_seisanyotei_su)
						, mokuhyo_hanbai_su: elem.mokuhyo_hanbai_su == null ? '' : addComma(elem.mokuhyo_hanbai_su)
						, royalty_kingaku: elem.royalty_kingaku == null ? '' : addComma(elem.royalty_kingaku)
						, chiiki: elem.chiiki_nm == null ? '' : elem.chiiki_nm							
					});
				});
			}
			
			if (ret3.countRow > 0) {
				// data配列を順に処理
				$.each(ret3.data,function(index, elem) {
					kyodakuShohinDataSet.push({
						//kyodaku_shohin_check: false
						 bunsho_edaban: elem.bunsho_edaban == null ? '' : elem.bunsho_edaban
						, shohin_hansokubutsu_hanbetsu_nm: elem.shohin_hansokubutsu_hanbetsu_nm == null ? '' : elem.shohin_hansokubutsu_hanbetsu_nm
						, shohin_nm: elem.shohin_nm == null ? '' : elem.shohin_nm
						, hatsubai_bi: elem.hatsubai_bi == null ? '' : elem.hatsubai_bi						
						, zeinuki_jodai: elem.zeinuki_jodai == null ? '' : addComma(elem.zeinuki_jodai)
						, ryoritsu: elem.ryoritsu == null ? '' : elem.ryoritsu
						, siyoryo: elem.siyoryo == null ? '' : addComma(elem.siyoryo)
						, saiteihosho_su_shinseisu: elem.saiteihosho_su_shinseisu == null ? '' : addComma(elem.saiteihosho_su_shinseisu)
						, saiteihosho_ryo_kyodakuryo: elem.saiteihosho_ryo_kyodakuryo == null ? '' : addComma(elem.saiteihosho_ryo_kyodakuryo)
						, shoshi_nm: elem.shoshi_nm == null ? '' : elem.shoshi_nm
						, mihon_suryo: elem.mihon_suryo == null ? '' : addComma(elem.mihon_suryo)
						, chiiki: elem.chiiki_nm == null ? '' : elem.chiiki_nm							
					});
				});
			}
			/*
			const emptyKyodakuShohinData = {
					kyodaku_shohin_check: false
					, kyodaku_edaban: ""
					, shohin_hansokubutsu_hanbetsu: ""
					, shohin_nm: ""
					, hatsubai_bi: ""
					, zeinuki_jodai: ""
					, ryoritsu: ""
					, siyoryo: ""
					, saiteihosho_su_shinseisu: ""
					, saiteihosho_ryo_kyodakuryo: ""
					, shoshi: ""
					, mihon_suryo: ""
					, chiiki: ""
				};
			*/
			
			console.log(kanrenbunshoDataSet);			
			
			// 簡易商標調査担当入力欄保存ボタン押下時
	        $('#btn_save_shohyo_kekka').click(function () {
	        	
	        	// 入力監視を解除
			    terminateFormChangeTrigger();
	        	
	        	let sendData = {};
				sendData.bunsho_id = $('#sendFrom').find('input[name=bunsho_id]').val();
				sendData.shohyo_chosa_kekka = $("#shohyo_chosa_kekka").val();
				sendData.shohyo_chosa_comment = $("#shohyo_chosa_comment").val();
				
	        	let ret = jsspRpcKawariDetail.shohyoKekkaSave(sendData);
				if (ret.error){
					alert(ret.msg);
					return;
				} else {
					window.location.href = "lo/contents/screen/common/wf_check?bunsho_id_with_shohyo_registered=" + sendData.bunsho_id;
				}
	        });
			
	     	// 提出ボタン(新規時)
	    	$('#btn_apply').click(function(){
	    		// 処理用ページを変更する
	            var nodeSetting = {};
	    		nodeSetting.procPage = "im_workflow/common/proc/lo/apply/apply_kawari"; //申請画面をデフォルトから変更 WEB-INF\conf\routing-jssp-config\im_workflow.xmlにパスを設定しておく
	    		$('#imwCustomParam').val(ImJson.toJSONString(nodeSetting));
	    		$('#imwNextScriptPath').val("lo/contents/screen/common/wf_check");// 処理後遷移
	    		$('#item_proc_status').val("apply");// 処理ステータス：申請(仮)
	    		$('#item_proc_name').val($.trim($(this).text()));
	    		setStatusCd($(this).attr("id")); //ステータスコード設定
	    		workflowOpenPage('0');
	    		return false;
	        });
	     	
	     	// 提出ボタン(再提出時)
	    	$('#btn_re_apply').click(function(){
	    		// 処理用ページを変更する
	            var nodeSetting = {};
	    		nodeSetting.procPage = "im_workflow/common/proc/lo/reapply/reapply_kawari"; //申請画面をデフォルトから変更 WEB-INF\conf\routing-jssp-config\im_workflow.xmlにパスを設定しておく
	    		$('#imwCustomParam').val(ImJson.toJSONString(nodeSetting));
	    		$('#imwNextScriptPath').val("lo/contents/screen/common/wf_check");// 処理後遷移
	    		$('#item_proc_status').val("reapply");// 処理ステータス：再申請(仮)
	    		$('#item_proc_name').val($.trim($(this).text()));
	    		setStatusCd($(this).attr("id")); //ステータスコード設定
	    		workflowOpenPage('3');
	    		return false;
	        });
	     	
	    	// 差戻ボタン(修正依頼)
	    	$('#btn_syusei_irai,#btn_sasimodosi').click(function(){
	            // 処理用ページを変更する
	            var nodeSetting = {};
	    		nodeSetting.procPage = "im_workflow/common/proc/lo/approve/approve_kawari"; //申請画面をデフォルトから変更 WEB-INF\conf\routing-jssp-config\im_workflow.xmlにパスを設定しておく
	    		$('#imwCustomParam').val(ImJson.toJSONString(nodeSetting));
	    		$('#imwNextScriptPath').val("lo/contents/screen/common/wf_check");// 処理後遷移
	      		$('#item_proc_status').val("sendback");// 処理ステータス：差戻(仮)
	    		$('#item_proc_name').val($.trim($(this).text()));
	    		setStatusCd($(this).attr("id")); //ステータスコード設定
	    		// 処理者設定
	    		workflowOpenPage('4');
	    		return false;
	        });
	    	
	    	// 取戻ボタン
	    	$('#btn_torimodosi').click(function(){
	            // 処理用ページを変更する

	            var nodeSetting = {};
	    		//nodeSetting.procPage = "im_workflow/common/proc/lo/approve/approve_kawari"; //申請画面をデフォルトから変更 WEB-INF\conf\routing-jssp-config\im_workflow.xmlにパスを設定しておく
	    		//$('#imwCustomParam').val(ImJson.toJSONString(nodeSetting));
	    		//$('#imwNextScriptPath').val("lo/contents/screen/common/wf_check");// 処理後遷移
	      		$('#item_proc_status').val("pullback");// 処理ステータス：差戻(仮)
	    		$('#item_proc_name').val($.trim($(this).text()));
	    		//setStatusCd($(this).attr("id")); //ステータスコード設定
	    		// 処理者設定
	    		//workflowOpenPage('4');
	    		//return false;	    		
				$("#lo_sidebar").css("z-index","1");
	    		
	    		$.imuiFormUtil.confirm('<imart type="string" value=$pullBackObj.confirmPullback/>', '<imart type="string" value=$pullBackObj.pullBackTitle/>', 
	    				function() {
	    					onClickPullback()
	    				}
	    		);

	    		return false;
	        });
	    	
	    	
	    	
			
	    	// 承認ボタン(起案、承認、完了)
	    	$('#btn_kian,#btn_shonin,#btn_kanryo').click(function(){
	            // 処理用ページを変更する
	            var nodeSetting = {};
	    		nodeSetting.procPage = "im_workflow/common/proc/lo/approve/approve_kawari"; //申請画面をデフォルトから変更 WEB-INF\conf\routing-jssp-config\im_workflow.xmlにパスを設定しておく
	    		$('#imwCustomParam').val(ImJson.toJSONString(nodeSetting));
	    		$('#imwNextScriptPath').val("lo/contents/screen/common/wf_check");// 処理後遷移
	    		$('#item_proc_status').val("approve");// 処理ステータス：承認(仮)
	    		$('#item_proc_name').val($.trim($(this).text()));
	    		setStatusCd($(this).attr("id")); //ステータスコード設定
	    		// 処理者設定
	    		workflowOpenPage('4');
	    		return false;
	        });
	    	
	    	// 再利用
	     	$('#btn_sairiyou').click(function(){
	     		showIndicator();
				// 企画id取得
			    var bunsho_id = $('#sendFrom').find('input[name=bunsho_id]').val();
				var sendData = {};
				sendData.bunsho_id = bunsho_id;

	    	  	ret = jsspRpcKawariDetail.sairiyou(sendData);
				if (ret.error){
					hideIndicator();
					alert('<imart type="message" id="KK02E016" escapeJs="true"></imart>');
					return;
				}

				alert(ret.msg + "\n" + ret.bunsho_id);
	        	// 一覧に戻る
	        	$('#sendFrom').find('input[name=bunsho_id]').val(ret.bunsho_id);
	        	$('#sendFrom').submit();
	     	});
			
			initializeNumFormat();
			
			$('#kanren_bunsho_table').DataTable({
				data: kanrenbunshoDataSet,
				// 件数切替機能 無効
				lengthChange: false,
				// 検索機能 無効
				searching: false,
				// ソート機能 無効
				ordering: false,
				// 情報表示 無効
				info: false,
				// ページング機能 無効
				paging: false,
				// 横スクロールバーを有効にする (scrollXはtrueかfalseで有効無効を切り替えます)
			    scrollX: false,
				"language": {
					"processing":   "処理中...",
					"lengthMenu":   "_MENU_ 件表示",
					"zeroRecords":  "データはありません。",
					"info":         "全 _TOTAL_ 件中 _START_ 件から _END_ 件まで表示",
					"infoEmpty":    " 0 件中 0 から 0 まで表示",
					"infoFiltered": "（全 _MAX_ 件より抽出）",
					"infoPostFix":  "",
					"search":       "検索:",
					"url":          "",
					"paginate": {
						"first":    "<i class='fas fa-backward' aria-hidden='true'></i>",
						"previous": "<i class='fas fa-caret-left' aria-hidden='true'></i>",
						"next":     "<i class='fas fa-caret-right' aria-hidden='true'></i>",
						"last":     "<i class='fas fa-forward' aria-hidden='true'></i>"
					}
				},
				autoWidth: false,
				columns: [
					{data: "kanren_bunsho_id",
						createdCell: function (cell, cellData, rowData, rowIndex, colIndex) {
							$(cell).addClass("brdr_ltgray");
					    },
						render:function(data, type, row, meta) {
							
							switch(row.bunsho_cls){
							case "1":							
								return '<a href="lo/contents/screen/kikaku/planning_detail_new?new_window_flg=1&kikaku_id=' + data + '" target="_blank">' + data + '</a>';
							case "2":							
								return '<a href="lo/contents/screen/kyodaku/permission_product_detail?new_window_flg=1&kyodaku_id=' + data + '" target="_blank">' + data + '</a>';
							case "3":							
								return '<a href="lo/contents/screen/kikaku/planning_detail_new?new_window_flg=1&kikaku_id=' + data + '" target="_blank">' + data + '</a>';
							case "4":
							case "5":
							case "6":
								return '<a href="lo/contents/screen/kawari/kawari_detail?new_window_flg=1&bunsho_id=' + data + '" target="_blank">' + data + '</a>';
							default:
								return data;
								
						
							}
						}
					},
					{data: "bunsho_cls_nm",
					    createdCell: function (cell, cellData, rowData, rowIndex, colIndex) {
							$(cell).addClass("brdr_ltgray");
					    },
					    render: $.fn.dataTable.render.text()
					},
					{data: "bunsho_nm",
					    createdCell: function (cell, cellData, rowData, rowIndex, colIndex) {
							$(cell).addClass("brdr_ltgray");
					    },
					    render: $.fn.dataTable.render.text()
					}

				]
			});
			
			$('#kikaku_shohin_table').DataTable({
				data: kikakuShohinDataSet,
				// 件数切替機能 無効
				lengthChange: false,
				// 検索機能 無効
				searching: false,
				// ソート機能 無効
				ordering: false,
				// 情報表示 無効
				info: false,
				// ページング機能 無効
				paging: false,
				// 横スクロールバーを有効にする (scrollXはtrueかfalseで有効無効を切り替えます)
			    scrollX: false,
				"language": {
					"processing":   "処理中...",
					"lengthMenu":   "_MENU_ 件表示",
					"zeroRecords":  "データはありません。",
					"info":         "全 _TOTAL_ 件中 _START_ 件から _END_ 件まで表示",
					"infoEmpty":    " 0 件中 0 から 0 まで表示",
					"infoFiltered": "（全 _MAX_ 件より抽出）",
					"infoPostFix":  "",
					"search":       "検索:",
					"url":          "",
					"paginate": {
						"first":    "<i class='fas fa-backward' aria-hidden='true'></i>",
						"previous": "<i class='fas fa-caret-left' aria-hidden='true'></i>",
						"next":     "<i class='fas fa-caret-right' aria-hidden='true'></i>",
						"last":     "<i class='fas fa-forward' aria-hidden='true'></i>"
					}
				},
				autoWidth: false,
				columns: [					
					{data: "bunsho_edaban",
					    createdCell: function (cell, cellData, rowData, rowIndex, colIndex) {
							$(cell).addClass("brdr_ltgray");
					    },
					    render: $.fn.dataTable.render.text()
					},					
					{data: "shohin_nm",
					    createdCell: function (cell, cellData, rowData, rowIndex, colIndex) {
							$(cell).addClass("brdr_ltgray");
					    },
					    render: $.fn.dataTable.render.text()
					},
					{data: "shohin_category",
					    createdCell: function (cell, cellData, rowData, rowIndex, colIndex) {
							$(cell).addClass("brdr_ltgray");
					    },
					    render: $.fn.dataTable.render.text()
					},
					{data: "hanbai_jiki",
					    createdCell: function (cell, cellData, rowData, rowIndex, colIndex) {
							$(cell).addClass("brdr_ltgray");
					    },
					    render: $.fn.dataTable.render.text()
					},
					{data: "kokuchi_kaishi_jiki",
					    createdCell: function (cell, cellData, rowData, rowIndex, colIndex) {
							$(cell).addClass("brdr_ltgray");
					    },
					    render: $.fn.dataTable.render.text()
					},
					{data: "chiiki",
					    createdCell: function (cell, cellData, rowData, rowIndex, colIndex) {
							$(cell).addClass("brdr_ltgray");
					    },
					    render: $.fn.dataTable.render.text()
					},
					{data: "zeinuki_jodai",
					    createdCell: function (cell, cellData, rowData, rowIndex, colIndex) {
							$(cell).addClass("brdr_ltgray text-right");
					    },
					    render: function(data, type, row, meta) {							
							return  data + "円";
						}
					},
					{data: "ryoritsu",
					    createdCell: function (cell, cellData, rowData, rowIndex, colIndex) {
							$(cell).addClass("brdr_ltgray text-right");
					    },
					    render: function(data, type, row, meta) {
									if (data == null || data == "") {
										return "0%";
									}
									return cngComma(data) + "%";
								}
					},
					{data: "shokai_seisanyotei_su",
					    createdCell: function (cell, cellData, rowData, rowIndex, colIndex) {
							$(cell).addClass("brdr_ltgray text-right");
					    },
					    render: function(data, type, row, meta) {							
							return  data + "個";
						}
					},
					{data: "mokuhyo_hanbai_su",
					    createdCell: function (cell, cellData, rowData, rowIndex, colIndex) {
							$(cell).addClass("brdr_ltgray text-right");
					    },
					    render: function(data, type, row, meta) {							
							return  data + "個";
						}
					},
					{data: "royalty_kingaku",
					    createdCell: function (cell, cellData, rowData, rowIndex, colIndex) {
							$(cell).addClass("brdr_ltgray text-right");
					    },
					    render: function(data, type, row, meta) {							
							return  data + "円";
						}
					}
					

				]
			});
			
			$('#kyodaku_shohin_table').DataTable({
				data: kyodakuShohinDataSet,
				// 件数切替機能 無効
				lengthChange: false,
				// 検索機能 無効
				searching: false,
				// ソート機能 無効
				ordering: false,
				// 情報表示 無効
				info: false,
				// ページング機能 無効
				paging: false,
				// 横スクロールバーを有効にする (scrollXはtrueかfalseで有効無効を切り替えます)
			    scrollX: false,
				"language": {
					"processing":   "処理中...",
					"lengthMenu":   "_MENU_ 件表示",
					"zeroRecords":  "データはありません。",
					"info":         "全 _TOTAL_ 件中 _START_ 件から _END_ 件まで表示",
					"infoEmpty":    " 0 件中 0 から 0 まで表示",
					"infoFiltered": "（全 _MAX_ 件より抽出）",
					"infoPostFix":  "",
					"search":       "検索:",
					"url":          "",
					"paginate": {
						"first":    "<i class='fas fa-backward' aria-hidden='true'></i>",
						"previous": "<i class='fas fa-caret-left' aria-hidden='true'></i>",
						"next":     "<i class='fas fa-caret-right' aria-hidden='true'></i>",
						"last":     "<i class='fas fa-forward' aria-hidden='true'></i>"
					}
				},
				autoWidth: false,
				columns: [					
					{data: "bunsho_edaban",
					    createdCell: function (cell, cellData, rowData, rowIndex, colIndex) {
							$(cell).addClass("brdr_ltgray");
					    },
					    render: $.fn.dataTable.render.text()
					},
					{data: "shohin_hansokubutsu_hanbetsu_nm",
					    createdCell: function (cell, cellData, rowData, rowIndex, colIndex) {
							$(cell).addClass("brdr_ltgray");
					    },
					    render: $.fn.dataTable.render.text()
					},
					{data: "shohin_nm",
					    createdCell: function (cell, cellData, rowData, rowIndex, colIndex) {
							$(cell).addClass("brdr_ltgray");
					    },
					    render: $.fn.dataTable.render.text()
					},					
					{data: "hatsubai_bi",
					    createdCell: function (cell, cellData, rowData, rowIndex, colIndex) {
							$(cell).addClass("brdr_ltgray");
					    },
					    render: $.fn.dataTable.render.text()
					},		
					
					{data: "zeinuki_jodai",
					    createdCell: function (cell, cellData, rowData, rowIndex, colIndex) {
							$(cell).addClass("brdr_ltgray text-right");
					    },
					    render: function(data, type, row, meta) {							
							return  data + "円";
						}
					},
					{data: "ryoritsu",
					    createdCell: function (cell, cellData, rowData, rowIndex, colIndex) {
							$(cell).addClass("brdr_ltgray text-right");
					    },
					    render: function(data, type, row, meta) {							
							return  data + "%";
						}
					},
					{data: "siyoryo",
					    createdCell: function (cell, cellData, rowData, rowIndex, colIndex) {
							$(cell).addClass("brdr_ltgray text-right");
					    },
					    render: function(data, type, row, meta) {							
							return  data + "円";
						}
					},					
					{data: "saiteihosho_su_shinseisu",
					    createdCell: function (cell, cellData, rowData, rowIndex, colIndex) {
							$(cell).addClass("brdr_ltgray text-right");
					    },
					    render: function(data, type, row, meta) {							
							return  data + "個";
						}
					},
					{data: "saiteihosho_ryo_kyodakuryo",
					    createdCell: function (cell, cellData, rowData, rowIndex, colIndex) {
							$(cell).addClass("brdr_ltgray text-right");
					    },
					    render: function(data, type, row, meta) {							
							return  data + "円";
						}
					},
					{data: "shoshi_nm",
					    createdCell: function (cell, cellData, rowData, rowIndex, colIndex) {
							$(cell).addClass("brdr_ltgray");
					    },
					    render: $.fn.dataTable.render.text()
					},
					{data: "mihon_suryo",
					    createdCell: function (cell, cellData, rowData, rowIndex, colIndex) {
							$(cell).addClass("brdr_ltgray text-right");
					    },
					    render: function(data, type, row, meta) {							
							return  data + "個";
						}
					},
					{data: "chiiki",
					    createdCell: function (cell, cellData, rowData, rowIndex, colIndex) {
							$(cell).addClass("brdr_ltgray");
					    },
					    render: $.fn.dataTable.render.text()
					}
					

				]
			});
			
		
		// ファイル選択ボタンをクリック
		$("#file_upload_btn").on("click", function() {
			var $form = $("#filesForm");
			var $file = $form.find(".imui-fileupload-input");
			$file.focus();
			$file.click(); //imartのファイルアップロード選択ボタンをクリックしてやる
		});
		
		
		$("#delete_btn").click(function() {
			if(window.confirm('<imart type="message" id="KY02C001" escapeJs="true"></imart>')){
				var result = deleteKyodakuData();
				if(result){
				    alert(result.altmsg);
				    location.href='./lo/contents/screen/kawari/kawari_list';
				}
			}
		});
		
		// 印刷ボタン
		$('#btn_print').click(function(){
			// プリントしたいエリアの取得
			var printArea = document.getElementsByClassName("print-area");
			// プリント用の要素「#print」を作成し、上で取得したprintAreaをその子要素に入れる。
			$('body').append('<div id="print" class="printBc"></div>');
			$(printArea).clone().appendTo('#print');
			$('#print .show-print-area').show();
			// サイズ調整
			$('#print').css('zoom','68%');
			// プリントしたいエリア意外に、非表示のcssが付与されたclassを追加
			$('body > :not(#print)').addClass('print-off');
			$('.not-print-area').addClass('print-off');
			// タイトル変更
			var orgTitle = $('title').html();
			//var printTitle = "【" + $('[name="keiyaku_cls_nm"]').html() + "】" + $('[name="kyodaku_cls_nm"]').html().trim() +  "_" + $('[name="bunsho_nm"]').html();
			var printTitle = $('[name="bunsho_nm"]').html();
			
			$('title').html(printTitle);
			
			// 印刷ダイアログ実行
			window.print();
			
			// 後処理
			$('title').html(orgTitle);
			$('#print').remove();
			$('#print').remove();
			$('.print-off').removeClass('print-off');
	    });	
		
		
	});
		
		// 押したボタン毎にステータスコードを設定
		function setStatusCd(btn_id){
			var setCd ="2";
			switch (btn_id){
			  case 'btn_teisyutu':
			  case 'btn_re_teisyutu':
			  case 'btn_kian':
				    setCd = "2"; // 受付待ち
			    	break;
			  case 'btn_syusei_irai':
				    setCd = "3"; // 修正依頼
					break;
			  case 'btn_juri':
				  	setCd = "4"; // 審査中
					break;
			  case 'btn_sasimodosi':
				    setCd = "5"; // 差戻
					break;
			  case 'btn_shonin':
				    setCd = "4"; // 承認
					break;
			  case 'btn_sakujo':
				    setCd = "12"; // 削除
					break;
			  case 'btn_kanryo':
				    setCd = "9"; // 完了
					break;
			  default:
			}
			// ステータスコードを設定
			$('#item_status_cd').val(setCd);		
		}
		
		function deleteKyodakuData() {

			var param = {
				bunsho_id : $.trim($("[name='bunsho_id']").val()) == '' ? null : $.trim($("[name='bunsho_id']").val())
				, koushin_bi : $.trim($("[name='koushin_bi']").val()) == '' ? null : $.trim($("[name='koushin_bi']").val())
			};
			
		    // 入力監視を解除
		    terminateFormChangeTrigger();
			
			var ret;
			try {
				ret = jsspRpcKawariDetail.deleteKyodaku(param);
		    } catch (ex) {
		    	imuiShowErrorMessage(ex.message, [], true, 5000, true);
		        return;
		    }
		    if(ret.error) {
		    	imuiShowErrorMessage(ret.message, [], true, 5000, true);
		    	return;
		    }
		    return ret;
		}
		
		function onClickPullback() {		    
			
		    var oReqParam = ImJson.parseJSON($('input[name="pullback_param"]').val());
		    
		    try {
		        var res = jsspRpcKawariDetail.actionPullback(oReqParam);
		        if (res.resultFlag) {		        	
		        	//タイトルを指定する例
		        	$("<div>取戻しを行いました。</div>").imuiMessageDialog({
		        	    iconType: 'im-ui-icon-common-24-confirmation',
		        	    title: 'メッセージ',
		        	    modal:true,
		        	    close: function(event, ui) {
		        	    	window.location.reload();
		        	    }
		        	});
		        } else {
		        	$("<div>取戻しに失敗しました。</div>").imuiMessageDialog({
		        	    iconType: 'error',
		        	    title: 'メッセージ',
		        	    modal:true,
		        	    close: function(event, ui) {
		        	    	window.location.reload();
		        	    }
		        	});
		        }
		    } catch (ex) {
		    	alert("error");
		        return imwShowErrorMessage('imui-container',ex.message);
		    }
		}
	</script>
</body>
