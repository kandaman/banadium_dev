<?xml version="1.0" encoding="UTF-8"?>
<configuration>
	<jmxConfigurator />

	<!-- 
	<statusListener class="ch.qos.logback.core.status.OnConsoleStatusListener" />
	-->

	<appender name="STDOUT" class="ch.qos.logback.core.ConsoleAppender">
		<encoder>
			<outputPatternAsHeader>true</outputPatternAsHeader>
			<pattern>[%level] %logger{10} - [%X{log.message.code}] %msg%n</pattern>
			<!--
			<charset>Windows-31J</charset>
			-->
		</encoder>		
	</appender>

	<appender name="FILE" class="ch.qos.logback.core.rolling.RollingFileAppender">
		<file>${im.log}/platform/system.log</file>
		<append>true</append>

		<!--
		<rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy">
			<fileNamePattern>
				${im.log}/platform/system-%d{yyyy-MM-dd}.log
			</fileNamePattern>
		</rollingPolicy>
		-->

		<rollingPolicy class="ch.qos.logback.core.rolling.FixedWindowRollingPolicy">
			<fileNamePattern>${im.log}/platform/system%i.log</fileNamePattern>
			<minIndex>1</minIndex>
			<maxIndex>5</maxIndex>
		</rollingPolicy>

		<triggeringPolicy class="ch.qos.logback.core.rolling.SizeBasedTriggeringPolicy">
			<maxFileSize>10MB</maxFileSize>
		</triggeringPolicy>

		<encoder class="ch.qos.logback.core.encoder.LayoutWrappingEncoder">
			<layout class="jp.co.intra_mart.common.platform.log.layout.OutputStackTracePatternLayout">
				<pattern>[%d{yyyy-MM-dd HH:mm:ss.SSS}]	[%thread]	%-5level	%logger{255}	%X{tenant.id}	%X{log.id}	%X{request.id}	-	[%X{log.message.code}]	%msg%nopex%n</pattern>
	
				<enableOutputStackTrace>true</enableOutputStackTrace>
				<stackTraceDir>${im.log}/platform/exception/</stackTraceDir>
				<stackTraceFilename>'exception_'yyyy-MM-dd_HH-mm-ss'_%logId.log'</stackTraceFilename>
			</layout>
			<immediateFlush>true</immediateFlush>
		</encoder>
	</appender>

	
	<!-- CACTUS用 -->
	<appender name="CACTUSFILE" class="ch.qos.logback.core.rolling.RollingFileAppender">
		<file>${im.log}/platform/cactusSystem.log</file>
		<append>true</append>
		<!--
		<rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy">
			<fileNamePattern>
				${im.log}/platform/system-%d{yyyy-MM-dd}.log
			</fileNamePattern>
		</rollingPolicy>
		-->
		<rollingPolicy class="ch.qos.logback.core.rolling.FixedWindowRollingPolicy">
			<fileNamePattern>${im.log}/platform/cactusSystem%i.log</fileNamePattern>
			<minIndex>1</minIndex>
			<maxIndex>5</maxIndex>
		</rollingPolicy>

		<triggeringPolicy class="ch.qos.logback.core.rolling.SizeBasedTriggeringPolicy">
			<maxFileSize>10MB</maxFileSize>
		</triggeringPolicy>

		<encoder class="ch.qos.logback.core.encoder.LayoutWrappingEncoder">
			<layout class="jp.co.intra_mart.common.platform.log.layout.OutputStackTracePatternLayout">
				<!-- <pattern>[%d{yyyy-MM-dd HH:mm:ss.SSS}]	[%thread]	%-5level	%logger{255}	%X{tenant.id}	%X{log.id}	%X{request.id}	-	[%X{log.message.code}]	%msg%nopex%n</pattern> -->
				<pattern>[%d{yyyy-MM-dd HH:mm:ss.SSS}]	%-5level	%logger{255}	%X{tenant.id}	%X{log.id}	%X{request.id}	-	%X{user.cd}	%msg%nopex%n</pattern>
				<enableOutputStackTrace>true</enableOutputStackTrace>
				<stackTraceDir>${im.log}/platform/exception/</stackTraceDir>
				<stackTraceFilename>'exception_'yyyy-MM-dd_HH-mm-ss'_%logId.log'</stackTraceFilename>
			</layout>
			<immediateFlush>true</immediateFlush>
		</encoder>
	</appender>


	<!--
	<appender name="EMAIL" class="ch.qos.logback.classic.net.SMTPAppender">
		<smtpHost>smtp_host</smtpHost>
		<to>to_mailaddress</to>
		<from>from_mailaddress</from>
		<layout class="ch.qos.logback.classic.PatternLayout">
			<Pattern>%date %-5level %logger{255} - %message%n</Pattern>
		</layout>
	</appender>
	-->

	<root>
		<level value="info" />
		<appender-ref ref="STDOUT" />
		<appender-ref ref="FILE" />
	</root>

	<!-- CACTUS用ログ -->
	<logger name="cactus">
		<level value="info" />
		<appender-ref ref="CACTUSFILE" />
  	</logger>
	<logger name="im_workflow.common.proc.custom">
		<level value="info" />
		<appender-ref ref="CACTUSFILE" />
  	</logger>
  	

	<!--
	   - Logger for Axis2
	  -->
	<logger name="org.apache.axis2.util.PrettyPrinter">
		<level value="error" />
	</logger>

	<!--
	   - Logger for SpyDataSource
	  -->
	<logger name="com.caucho.sql.spy">
		<level value="trace" />
	</logger>

	<!--
	   - Logger for OpenPortal
	  -->
	<logger name="debug.com.sun.portal.portletcontainer.impl">
		<level value="warn" />
	</logger>

	<logger name="com.sun.portal.portletcontainer.context.window.impl">
		<level value="warn" />
	</logger>

	<!--
	   - Logger for WSRP
	  -->
	<logger name="com.sun.xml.wss.logging.impl.filter">
		<level value="warn" />
	</logger>

	<!--
	   - Logger for Session Timeout
	  -->
	<logger name="error-page.session-timeout">
		<level value="off" />
	</logger>

</configuration>
